<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="./assets/img/favicon.png">
  <title>
    Poznań University of Technology
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <!-- CSS Files -->
  <link id="pagestyle" href="./assets/css/soft-design-system.css?v=1.0.5" rel="stylesheet" />
</head>

<body class="index-page">
  <!-- Navbar -->
  <div class="container position-sticky z-index-sticky top-0">
    <div class="row">
      <div class="col-12">
        <nav
          class="navbar navbar-expand-lg  blur blur-rounded top-0 z-index-fixed shadow position-absolute my-3 py-2 start-0 end-0 mx-4">
          <div class="container-fluid">
            <a class="navbar-brand font-weight-bolder ms-sm-3" href="index.html" rel="tooltip"
              title="Designed and Coded by Creative Tim" data-placement="bottom">
              Poznań University of Technology
            </a>
          </div>
          <div class="collapse navbar-collapse pt-3 pb-2 py-lg-0 w-100" id="navigation">
            <ul class="navbar-nav navbar-nav-hover ms-lg-12 ps-lg-5 w-100">
              </li>
              <li class="nav-item ms-lg-auto">
                <a id="signin" href="sign-in.html" class="btn btn-sm  bg-gradient-primary  btn-round mb-0 me-1 mt-2 mt-md-0">Sign in</a>
                <p id="identity" class="d-inline text-sm z-index-1 font-weight-bold" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">Arthur COAT</p>
                <i id="icon-logout" class="fas fa-sign-out-alt" style="margin-left: 20px;" onclick="logout()"></i>
              </li>
            </ul>
          </div>
        </nav>
        <!-- End Navbar -->
      </div>
    </div>
  </div>
  <header class="header-2">
    <div class="page-header min-vh-75" style="background-image: url('./assets/img/curved-images/curved.jpg')">
      <div class="container">
        <div class="row">
          <div class="col-lg-7 text-center mx-auto">
            <h1 data-course-title class="text-white pt-2 mt-n5">Software Developement Studio 2</h1>
          </div>
        </div>
      </div>
      <div class="position-absolute w-100 z-index-1 bottom-0">
        <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
          viewBox="0 24 150 40" preserveAspectRatio="none" shape-rendering="auto">
          <defs>
            <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
          </defs>
          <g class="moving-waves">
            <use xlink:href="#gentle-wave" x="48" y="-1" fill="rgba(255,255,255,0.40" />
            <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.35)" />
            <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.25)" />
            <use xlink:href="#gentle-wave" x="48" y="8" fill="rgba(255,255,255,0.20)" />
            <use xlink:href="#gentle-wave" x="48" y="13" fill="rgba(255,255,255,0.15)" />
            <use xlink:href="#gentle-wave" x="48" y="16" fill="rgba(255,255,255,0.95" />
          </g>
        </svg>
      </div>
    </div>
  </header>

  <section class="py-4">
    <div class="container">
      <div class="row">
        <div class="col-lg-7 z-index-2 border-radius-xl mt-n10 mx-auto py-3 blur shadow-blur">
          <div class="row">
            <div class="col-md-4 position-relative">
              <div class="p-4 text-center">
                <h1 data-course-ects class="text-gradient text-primary"><span id="state1" countto="6">6</span></h1>
                <h5 class="mt-3">ECTS</h5>
              </div>
              <hr class="vertical dark">
            </div>
            <div class="col-md-4 position-relative">
              <div class="p-4 text-center">
                <h1 data-course-hours class="text-gradient text-primary"> <span id="state2" countto="60">60</span></h1>
                <h5 class="mt-3">Number of hours</h5>
              </div>
              <hr class="vertical dark">
            </div>
            <div class="col-md-4 position-relative">
              <div class="p-4 text-center">
                <h1 data-course-semester class="text-gradient text-primary"><span>Winter</span></h1>
                <h5 class="mt-3">Semester</h5>
              </div>
              <hr class="vertical dark">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="py-4">
    <div class="container">
      <div class="row justify-space-between py-2">
        <div class="col-12 mx-auto">
          <div class="card">
            <div class="card-body">
              <h4>Course objective</h4>
              <p data-course-description>
                1. Provide to the students the foundations of project management and requirements engineering (and
                illustrate them with real-life cases) that are necessary to perform the management and analytical roles
                in software development projects,
                <br />
                2. Development of the skills related to the software product development (especially, the skills related
                to project management, requirements engineering, and software architecture) by participation in a
                capstone project. The goal of the project is to solve a problem of a real customer. The main focus is on
                developing skills related to managing a software development team, requirements engineering (maintaining
                Product Backlog), and software architectures.
                <br />
                3. Development of communication and team-work skills.
                <br />
                The course extends Software development studio 1.
              </p>
              <a href="courses/description-software_development_studio_2.pdf" target="_blank"
                class="text-primary icon-move-left" data-course-description-link>
                <i class="fas fa-file-pdf text-xs ms-1" ria-hidden="true"></i>
                See the course description card (ECTS)
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div class="container py-4">
    <div class="row">
      <div class="col-lg-6 mx-auto text-center">
        <h2 class="mb-3">Coordinator(s)</h2>
      </div>
    </div>
    <div class="row" id="coordinators">
      <template id="coordinator-card">
        <div class="col-lg-6 col-12">
          <div class="card-profile overflow-hidden">
            <div class="col-lg-6 col-md-6 col-12 ps-lg-0 my-auto">
              <div class="card-body">
                <h5 data-coordinator-card-name class="mb-0">Dariusz Brzezinski</h5>
                <h6 data-coordinator-card-email class="text-info">Dariusz.Brzezinski@cs.put.poznan.pl</h6>
              </div>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>

  <section class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-lg-6 mx-auto text-center">
          <h2 class="mb-3">Testimonials</h2>
          <p>Reviews of previous Erasmus+ students about this course</p>
        </div>
      </div>
      <section id="testimonials">
        <div class="row mt-6">
          <template id="testimonial-card">
            <div class="col-lg-4 col-md-8">
            <div class="card">
              <div class="card-body">
                <div class="author align-items-center">
                  <img data-testimonial-card-avatar src="./assets/img/team-1.jpg" alt="..." class="avatar shadow">
                  <div class="name ps-2">
                    <span data-testimonial-card-user>Luciana Machado</span>
                    <div class="stats">
                      <small data-testimonial-card-year>2021</small>
                    </div>
                  </div>
                </div>
                <p data-testimonial-card-comment class="mt-4">"If you have the opportunity to play this game of life you need to appreciate every moment."</p>
              </div>
            </div>
          </template>
        </div>
      </section>
    </div>

    <div id="addTestimonialSection" class="container">
      <div class="row">
        <div class="col-lg-7 d-flex justify-content-center flex-column">
          <div class="justify-content-center p-4 shadow-lg my-sm-0 my-sm-6 mt-8 mb-5">
            <div class="text-center">
              <h3 class="text-gradient text-primary">Add my testimonial</h3>
            </div>
            <form id="testimonial-form" method="post" autocomplete="off">
                <div class="form-group mb-0 mt-md-0 mt-4">
                  <label>Short summary of what you like about this course, what could be improved and what you didn't like.</label>
                  <textarea name="comment" class="form-control" id="comment" rows="6" placeholder="250 characters maximum"></textarea>
                </div>
                <div class="row">
                  <div class="col-md-12 text-center">
                    <button id="submit-testimonial" type="submit" class="btn bg-gradient-primary mt-3 mb-0" onclick="createTestimonial()">Send my testimonial</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="col-md-5 ms-auto">
            <div class="position-relative">
              <img class="max-width-50 w-100 position-relative z-index-2" src="./assets/img/illustrations/chat.png" alt="image">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer pt-5 mt-5">
    <hr class="horizontal dark mb-5">
    <div class="container">
      <div class=" row">
        <div class="col-md-3 mb-4 ms-auto">
          <div>
            <h6 class="text-gradient text-primary font-weight-bolder">Poznań University of Technology</h6>
          </div>
        </div>
        <div class="col-12">
          <div class="text-center">
            <p class="my-4 text-sm">
              All rights reserved. Copyright © <script>
                document.write(new Date().getFullYear())
              </script> Soft UI Design System by <a href="https://www.creative-tim.com" target="_blank">Creative
                Tim</a>.
            </p>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script type="text/javascript">
    const BASE_URL = 'http://localhost:8080';
    const COURSES_URL = 'faculties/{facultyId}/courses/{courseId}';
    const TESTIMONIAL_URL = 'faculties/{facultyId}/courses/{courseId}/testimonial';

    // get faculty id param
    const paramsString = window.location.search;
    let facultyId;
    let courseId;
    let searchParams = new URLSearchParams(paramsString);
    if (searchParams.has('faculty') && searchParams.get('faculty') &&
      searchParams.has('id') && searchParams.get('id')) {
      facultyId = searchParams.get('faculty');
      courseId = searchParams.get('id');

      let courseUrl = COURSES_URL
        .replace('{facultyId}', facultyId)
        .replace('{courseId}', courseId);

      fetch(`${BASE_URL}/${courseUrl}`)
        .then(response => response.json())
        .then(data => {
          editCourseInformation(data);
          createCoordinatorCards(data);
          createTestimonialCards(data);
          hideAddTestimonialSection(data);
        })
        .catch(error => console.error('Request failed', error));
    }

    /**
     * Create Faculty cards with a card template
     */
    function editCourseInformation(course) {
      document.querySelector('[data-course-title]').textContent = course.title;
      document.querySelector('[data-course-ects]').textContent = course.ects;
      document.querySelector('[data-course-hours]').textContent = course.hours;
      document.querySelector('[data-course-semester]').textContent = course.semester.charAt(0) + course.semester.slice(1).toLowerCase();
      document.querySelector('[data-course-description]').textContent = course.description;
      document.querySelector('[data-course-description-link]').href = `courses/${course.descriptionCardUrl}`;;
    }

    function createCoordinatorCards(course) {
      if ('content' in document.createElement('template')) {
        var coordinatorsRow = document.querySelector("#coordinators");
        var template = document.querySelector('#coordinator-card');

        course.coordinators.forEach(coordinator => {
          var clone = template.content.cloneNode(true);
          clone.querySelector('[data-coordinator-card-name]').textContent = `${coordinator.name} ${coordinator.lastName}`;
          clone.querySelector('[data-coordinator-card-email]').textContent = coordinator.email;
          // Add new coordinator card
          coordinatorsRow.appendChild(clone);
        });
      } else {
        console.error('Template not supported!')
      // Find another way to add the rows to the table because
      // the HTML template element is not supported.
      }
    }

    const nbTestimonialCardsByRow = 3;
    function createTestimonialCards(course) {
      if ('content' in document.createElement('template')) {
        var testimonialsSection = document.querySelector("#testimonials");
        var template = document.querySelector('#testimonial-card');
        var lastRow;

        let teamNumber = 1;
        course.testimonials.forEach((testimonial, index) => {
          teamNumber = index % nbTestimonialCardsByRow + 1;

          var clone = template.content.cloneNode(true);
          clone.querySelector('[data-testimonial-card-avatar]').src = `./assets/img/team-${teamNumber}.jpg`;
          clone.querySelector('[data-testimonial-card-user]').textContent = `${testimonial.erasmusStudent.firstname} ${testimonial.erasmusStudent.lastname}`;
          clone.querySelector('[data-testimonial-card-year]').textContent = new Date(testimonial.date).getFullYear();
          clone.querySelector('[data-testimonial-card-comment]').textContent = testimonial.comment;
          if (index % nbTestimonialCardsByRow == 0) {
            // create row
            lastRow = document.createElement("div");
            testimonialsSection.appendChild(lastRow).className = "row mt-6";
          }
          // Add new course card
          lastRow.appendChild(clone);
        });
      } else {
        console.error('Template not supported!')
      // Find another way to add the rows to the table because
      // the HTML template element is not supported.
      }
    }

    function createTestimonial() {
      const comment = document.querySelector("#comment").value;

      let testimonialUrl = TESTIMONIAL_URL
        .replace('{facultyId}', facultyId)
        .replace('{courseId}', courseId);

      try {
        (async () => {
          const rawResponse = await fetch(`${BASE_URL}/${testimonialUrl}`, {
            method: "POST",
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              erasmusStudent: {
                email: window.localStorage.getItem("email")
              },
              comment: comment,
              date: new Date(),
              course: {
                id: courseId
              }
            })
          });

          const content = await rawResponse.json();
          console.log(content);
          window.location.reload();
        })();
      } catch(error) {
        console.error('Request failed', error);
      }
    }

    function hide (elements) {
      elements = elements.length ? elements : [elements];
      for (var index = 0; index < elements.length; index++) {
        elements[index].style.display = 'none';
      }
    }

    /**
     * Hide add testimonial part if user is not logged or he has already post a comment
    */
    function hideAddTestimonialSection(course) {
      if (!window.localStorage.getItem("token")) {
        hide(document.getElementById('addTestimonialSection'));
      } else {
        course.testimonials.forEach(testimonial => {
          if (testimonial.erasmusStudent.email == window.localStorage.getItem("email")) {
            hide(document.getElementById('addTestimonialSection'));
          }
        });
      }
    }

    function logout() {
      window.localStorage.removeItem("token");
      window.localStorage.removeItem("firstname");
      window.localStorage.removeItem("lastname");
      window.localStorage.removeItem("email");
      window.location.href = "sign-in.html";
    }

    // Avoid form's submission
    var form = document.getElementById("testimonial-form");
    function handleForm(event) { event.preventDefault(); } 
    form.addEventListener('submit', handleForm);

    if (window.localStorage.getItem("token")) {
      document.querySelector('#signin').style.display = "none";
      const firstName = window.localStorage.getItem("firstname");
      const lastName = window.localStorage.getItem("lastname");
      document.querySelector('#identity').textContent = `${firstName} ${lastName}`;
    } else {
      document.querySelector('#identity').textContent = "";
      document.querySelector('#signin').textContent = "Sign in";
    }
  </script>
</body>

</html>